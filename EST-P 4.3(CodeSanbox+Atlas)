Below is the FULL, CLEAN, UPDATED GUIDE + WORKING CODE to fix your MongoDB timeout error and properly run your:

‚úÖ E-commerce Catalog with Nested Documents (MongoDB + Node.js + Mongoose)
‚ö†Ô∏è Also includes: Correct connection string placement, folder structure, and updated working code that avoids the buffering timeout error you got.

‚úÖ PART 1 ‚Äî FULL STEPS (DO THESE IN ORDER)
STEP 1 ‚Äî Folder Structure (No nesting)
/models
/controllers
/routes
server.js


Create the 3 folders exactly like above.

STEP 2 ‚Äî Install required modules

Run:

npm install express mongoose

STEP 3 ‚Äî Add your correct MongoDB connection string
You MUST place connection string inside server.js
mongodb+srv://cloudcu641_db_user:3XR5HumzZ9JRb8dY@cluster0.1p0kcdj.mongodb.net/ecomdb


‚ö†Ô∏è NOTE:
Database name required ‚Üí /ecomdb

‚úÖ PART 2 ‚Äî COMPLETE CODE (COPY‚ÄìPASTE EXACTLY)
‚úÖ server.js (MAIN FILE)
const express = require("express");
const mongoose = require("mongoose");

const app = express();
app.use(express.json());

// Step 4 ‚Äî Connect to MongoDB Atlas
mongoose.connect(
  "mongodb+srv://cloudcu641_db_user:3XR5HumzZ9JRb8dY@cluster0.1p0kcdj.mongodb.net/ecomdb",
  {
    useNewUrlParser: true,
    useUnifiedTopology: true,
  }
)
.then(() => console.log("‚úî MongoDB Connected"))
.catch((err) => console.log("MongoDB Error:", err));

// Routes
const productRoutes = require("./routes/productRoutes");
app.use("/products", productRoutes);

const PORT = 3000;
app.listen(PORT, () => console.log(`Server running on port ${PORT}`));

‚úÖ models/Product.js
const mongoose = require("mongoose");

const variantSchema = new mongoose.Schema({
  color: String,
  size: String,
  stock: Number
});

const productSchema = new mongoose.Schema({
  name: String,
  price: Number,
  category: String,
  variants: [variantSchema]
});

module.exports = mongoose.model("Product", productSchema);

‚úÖ controllers/productController.js
const Product = require("../models/Product");

// Insert sample products
exports.insertSample = async (req, res) => {
  try {
    await Product.deleteMany(); // clear collection

    const products = [
      {
        name: "T-Shirt",
        price: 499,
        category: "Clothing",
        variants: [
          { color: "Red", size: "M", stock: 50 },
          { color: "Blue", size: "L", stock: 30 }
        ]
      },
      {
        name: "Shoes",
        price: 1499,
        category: "Footwear",
        variants: [
          { color: "Black", size: "42", stock: 20 },
          { color: "White", size: "40", stock: 10 }
        ]
      }
    ];

    await Product.insertMany(products);
    res.send("Sample products inserted");
  } catch (err) {
    res.status(500).send(err);
  }
};

// Get all products
exports.getAll = async (req, res) => {
  const data = await Product.find();
  res.json(data);
};

// Filter by category
exports.getByCategory = async (req, res) => {
  const data = await Product.find({ category: req.params.cat });
  res.json(data);
};

‚úÖ routes/productRoutes.js
const express = require("express");
const router = express.Router();
const controller = require("../controllers/productController");

// Insert sample data
router.get("/insert", controller.insertSample);

// Get all products
router.get("/", controller.getAll);

// Filter by category
router.get("/category/:cat", controller.getByCategory);

module.exports = router;

‚úÖ PART 3 ‚Äî HOW TO RUN
Start server
node server.js


If successful, you will see:

‚úî MongoDB Connected
Server running on port 3000

‚úÖ PART 4 ‚Äî TEST ROUTES
1Ô∏è‚É£ Insert sample nested products

Open in browser:

http://localhost:3000/products/insert


Output:

Sample products inserted

2Ô∏è‚É£ Get all products
http://localhost:3000/products

3Ô∏è‚É£ Get products by category

Example:

http://localhost:3000/products/category/Clothing

üü¢ FIX FOR YOUR ERROR

You got:

MongooseError: Operation `products.deleteMany()` buffering timed out


This happens when:

Connection string missing database name

Connection was not established before using model

‚úî My updated code fixes this by adding correct db:

...mongodb.net/ecomdb


‚úî And establishing connection before running any model operation.

If you want, I can also give you:

‚úÖ MVC version
‚úÖ CRUD routes (add, update, delete)
‚úÖ Postman collection
‚úÖ CodeSandbox version

Just tell me!
